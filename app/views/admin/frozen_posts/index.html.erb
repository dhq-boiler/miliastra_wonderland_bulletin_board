<div class="container">
  <div class="admin-header">
    <h1>凍結された投稿の管理</h1>
    <p>AI判定により仮凍結された投稿を確認し、本処分を決定します</p>
  </div>

  <!-- 統計情報 -->
  <div class="admin-stats">
    <div class="stat-card">
      <div class="stat-value"><%= @stats[:total] %></div>
      <div class="stat-label">凍結済み合計</div>
    </div>
    <div class="stat-card">
      <div class="stat-value"><%= @stats[:temporary] %></div>
      <div class="stat-label">仮凍結</div>
    </div>
    <div class="stat-card">
      <div class="stat-value"><%= @stats[:permanent] %></div>
      <div class="stat-label">永久凍結</div>
    </div>
  </div>

  <!-- フィルター -->
  <div class="admin-filters">
    <%= link_to "すべて", admin_frozen_posts_path, class: "filter-btn #{@filter == 'all' ? 'active' : ''}" %>
    <%= link_to "仮凍結", admin_frozen_posts_path(filter: "temporary"), class: "filter-btn #{@filter == 'temporary' ? 'active' : ''}" %>
    <%= link_to "永久凍結", admin_frozen_posts_path(filter: "permanent"), class: "filter-btn #{@filter == 'permanent' ? 'active' : ''}" %>
  </div>

  <!-- 凍結された投稿リスト -->
  <div class="admin-table-container">
    <% if @frozen_posts.empty? %>
      <div class="empty-state">
        <p>凍結された投稿はありません</p>
      </div>
    <% else %>
      <table class="admin-table">
        <thead>
          <tr>
            <th>タイプ</th>
            <th>内容</th>
            <th>投稿者</th>
            <th>凍結理由</th>
            <th>凍結タイプ</th>
            <th>凍結日時</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          <% @frozen_posts.each do |post| %>
            <tr class="frozen-post-row <%= post.frozen_type %>">
              <td>
                <% if post.is_a?(Stage) %>
                  <span class="badge badge-primary">ステージ</span>
                <% else %>
                  <span class="badge badge-secondary">コメント</span>
                <% end %>
              </td>
              <td class="content-cell">
                <% if post.is_a?(Stage) %>
                  <div class="post-title"><%= link_to post.title, stage_path(post), target: "_blank" %></div>
                  <div class="post-excerpt"><%= truncate(post.description, length: 100) %></div>
                <% else %>
                  <div class="post-title">
                    <%= link_to post.multiplay_recruitment.title, multiplay_recruitment_path(post.multiplay_recruitment), target: "_blank" %>
                  </div>
                  <div class="post-excerpt"><%= truncate(post.content, length: 100) %></div>
                <% end %>
              </td>
              <td>
                <%= link_to post.user.display_name, admin_user_path(post.user) %>
              </td>
              <td class="reason-cell">
                <%= simple_format(post.frozen_reason) %>
              </td>
              <td>
                <% if post.temporarily_frozen? %>
                  <span class="status-badge status-temporary">仮凍結</span>
                <% elsif post.permanently_frozen? %>
                  <span class="status-badge status-permanent">永久凍結</span>
                <% end %>
              </td>
              <td>
                <%= time_ago_in_words(post.frozen_at) %>前
              </td>
              <td class="actions-cell">
                <% if post.is_a?(Stage) %>
                  <% unless post.permanently_frozen? %>
                    <%= button_to "永久凍結", admin_frozen_posts_permanent_freeze_stage_path(post),
                        method: :patch,
                        class: "btn btn-sm btn-warning",
                        data: { confirm: "本当に永久凍結しますか？" } %>
                  <% end %>
                  <%= button_to "凍結解除", admin_frozen_posts_unfreeze_stage_path(post),
                      method: :patch,
                      class: "btn btn-sm btn-success",
                      data: { confirm: "凍結を解除しますか？（誤検知の場合）" } %>
                  <%= button_to "削除", admin_frozen_posts_destroy_stage_path(post),
                      method: :delete,
                      class: "btn btn-sm btn-danger",
                      data: { confirm: "本当に削除しますか？この操作は取り消せません。" } %>
                <% else %>
                  <% unless post.permanently_frozen? %>
                    <%= button_to "永久凍結", admin_frozen_posts_permanent_freeze_comment_path(post),
                        method: :patch,
                        class: "btn btn-sm btn-warning",
                        data: { confirm: "本当に永久凍結しますか？" } %>
                  <% end %>
                  <%= button_to "凍結解除", admin_frozen_posts_unfreeze_comment_path(post),
                      method: :patch,
                      class: "btn btn-sm btn-success",
                      data: { confirm: "凍結を解除しますか？（誤検知の場合）" } %>
                  <%= button_to "削除", admin_frozen_posts_destroy_comment_path(post),
                      method: :delete,
                      class: "btn btn-sm btn-danger",
                      data: { confirm: "本当に削除しますか？この操作は取り消せません。" } %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% end %>
  </div>
</div>
