# 管理者ツール クイックリファレンス

本番環境での管理者ユーザー管理のためのRakeタスクです。

## 🔑 管理者機能について

管理者ユーザーは以下の特別な権限を持ちます：

- ✅ **全投稿の削除権限**: 他のユーザーの投稿を削除できます
- 🏷️ **管理者バッジ**: ユーザー名の横に「管理者」バッジが表示されます
- 🛡️ **管理者専用作成**: 管理者ユーザーは `admin:create` タスクでのみ作成できます（通常の新規登録では作成不可）

> **注意**: 管理者は投稿の編集はできません。削除のみ可能です。

---

## 📝 利用可能なコマンド

### 1. 管理者ユーザーの作成
```bash
bin/rails admin:create
```

**用途**: 本番環境で新しい管理者ユーザーを作成
**セキュリティ**: パスワードはマスクされ、ログに記録されません
**権限**: 作成されたユーザーは管理者権限を持ちます

**実行例**:
```
$ bin/rails admin:create

==========================================
   管理者ユーザー作成ツール
==========================================
このツールは本番環境での管理者作成に使用できます。
※ 入力した情報はログに記録されません。
※ 管理者は全ての投稿を削除できる権限を持ちます。

メールアドレスを入力してください（任意、Enterでスキップ）: admin@example.com
ユーザー名を入力してください (3〜20文字): admin_user
パスワードを入力してください (6文字以上): ******
パスワードを再入力してください: ******

✓ 管理者ユーザーが正常に作成されました！
==========================================
  メールアドレス: admin@example.com
  ユーザー名: admin_user
  権限: 管理者
  作成日時: 2025-11-09 00:00:00 UTC
==========================================

このユーザーでログインできます。
管理者として全ての投稿を削除できる権限があります。
```

---

### 2. ユーザー一覧の表示
```bash
bin/rails admin:list
```

**用途**: 登録されている全ユーザーの情報を確認
**表示内容**: ユーザー名、メールアドレス、登録日時、投稿数

**実行例**:
```
$ bin/rails admin:list

==========================================
   登録ユーザー一覧
==========================================

[1] admin_user [管理者]
    Email: admin@example.com
    登録日: 2025-11-09 00:00:00
    投稿数: 5

[2] player1
    Email: player1@example.com
    登録日: 2025-11-08 12:00:00
    投稿数: 3

合計: 2人 (管理者: 1人)
==========================================
```

---

### 3. パスワード変更
```bash
bin/rails admin:change_password
```

**用途**: ユーザーのパスワードを変更
**対象**: ユーザー名またはメールアドレスで指定

**実行例**:
```
$ bin/rails admin:change_password

==========================================
   パスワード変更ツール
==========================================
ユーザー名またはメールアドレスを入力: admin_user

対象ユーザー: admin_user [管理者] (admin@example.com)

新しいパスワードを入力してください (6文字以上): ******
パスワードを再入力してください: ******

✓ パスワードを変更しました。
```

---

### 4. ユーザー削除
```bash
bin/rails admin:delete
```

**用途**: ユーザーとその全投稿を削除
**警告**: ⚠️ この操作は取り消せません！

**実行例**:
```
$ bin/rails admin:delete

==========================================
   ユーザー削除ツール
==========================================
⚠️  警告: この操作は取り消せません！

削除するユーザーのユーザー名またはメールアドレスを入力: spam_user

削除対象ユーザー:
  ユーザー名: spam_user
  メール: spam@example.com
  権限: 一般ユーザー
  投稿数: 10

⚠️  このユーザーと関連する全ての投稿が削除されます。

本当に削除しますか? (yes/no): yes

✓ ユーザー 'spam_user' を削除しました。
```

---

## 🚀 本番環境での実行

### Herokuの場合
```bash
# 管理者作成
heroku run rails admin:create -a your-app-name

# ユーザー一覧
heroku run rails admin:list -a your-app-name

# パスワード変更
heroku run rails admin:change_password -a your-app-name
```

### SSH接続後
```bash
cd /path/to/app
RAILS_ENV=production bundle exec rails admin:create
```

### Dockerコンテナの場合
```bash
docker exec -it container_name rails admin:create
```

---

## 🔒 セキュリティ注意事項

1. **パスワード入力時**: パスワードはマスクされ、ログに記録されません
2. **本番環境**: 必ず安全な接続（SSH、VPN等）を使用してください
3. **強力なパスワード**: 本番環境では必ず強力なパスワードを使用してください
4. **削除操作**: ユーザー削除は取り消せないため、慎重に実行してください

---

## 💡 Tips

- コマンドは開発環境でもテスト可能です
- `bin/rails -T admin` で利用可能なタスク一覧を確認できます
- エラーが発生した場合、詳細なメッセージが表示されます
- 既存のメールアドレスやユーザー名は使用できません（重複チェック）

---

## 📚 関連ドキュメント

- [README.md](../README.md) - アプリケーション全体のドキュメント
- [db/seeds.rb](../db/seeds.rb) - 開発環境用のサンプルデータ作成

