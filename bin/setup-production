#!/bin/bash

# Production Environment Setup Script
# This script helps you set up the production environment configuration

set -e

echo "================================"
echo "æœ¬ç•ªç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ"
echo "================================"
echo ""

# Check if .env already exists
if [ -f .env ]; then
    echo "âš ï¸  .envãƒ•ã‚¡ã‚¤ãƒ«ãŒæ—¢ã«å­˜åœ¨ã—ã¾ã™ã€‚"
    read -p "ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ (y/N): " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        echo "ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸã€‚"
        exit 0
    fi
fi

# Copy production template
echo "ğŸ“„ .env.productionã‚’ã‚³ãƒ”ãƒ¼ã—ã¦.envã‚’ä½œæˆä¸­..."
cp .env.production .env

echo ""
echo "âœ… .envãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¾ã—ãŸï¼"
echo ""
echo "æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:"
echo ""
echo "1ï¸âƒ£  RAILS_MASTER_KEYã‚’å–å¾—:"
echo "   cat config/master.key"
echo ""
echo "2ï¸âƒ£  å¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’2ã¤ç”Ÿæˆ:"
echo "   openssl rand -base64 32"
echo "   openssl rand -base64 32"
echo ""
echo "3ï¸âƒ£  .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†:"
echo "   vim .env"
echo ""
echo "   ä»¥ä¸‹ã‚’è¨­å®šã—ã¦ãã ã•ã„:"
echo "   - RAILS_MASTER_KEY"
echo "   - DB_HOST (ã‚µãƒ¼ãƒãƒ¼ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹)"
echo "   - POSTGRES_PASSWORD (ç”Ÿæˆã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰1)"
echo "   - DB_PASSWORD (ç”Ÿæˆã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰2)"
echo ""
echo "4ï¸âƒ£  .kamal/secretsã‚’ä½œæˆ:"
echo "   cp .kamal/secrets.example .kamal/secrets"
echo "   chmod 600 .kamal/secrets"
echo ""
echo "5ï¸âƒ£  ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿè¡Œ:"
echo "   bin/kamal setup"
echo ""
echo "================================"

