#!/bin/bash -e

# Setup log directory
echo "Setting up log directory..."
mkdir -p /rails/log
chmod 755 /rails/log
echo "Log directory setup complete!"

# Optional: Run database migrations if AUTO_MIGRATE is set
if [ "${AUTO_MIGRATE}" = "true" ] && [ "${1}" = "./bin/rails" ] && [ "${2}" = "server" ]; then
  echo "Running database migrations (AUTO_MIGRATE=true)..."
  ./bin/rails db:create 2>&1 || true
  ./bin/rails db:migrate 2>&1 || true
  echo "Database migrations complete!"
fi

exec "${@}"
